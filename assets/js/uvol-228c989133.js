if("undefined"==typeof uvol||!uvol)var uvol={};if(uvol.global={},uvol.global={dev:!1,modulePath:"/assets/js/uvol-plugins/",loadedModules:[],initialisedModules:[],loadedModulesCallbackChain:[],simplemde:{},moduleMap:null,setDev:function(){uvol.global.dev=!0},loader:function(e,t){var a=document.createElement("script");a.type="text/javascript",a.readyState?a.onreadystatechange=function(){"loaded"!=a.readyState&&"complete"!=a.readyState||(a.onreadystatechange=null,t())}:a.onload=function(){t()},a.src=e,document.getElementsByTagName("head")[0].appendChild(a)},css:function(e){$("head").append($('<link rel="stylesheet" type="text/css" href="'+e+'">'))},namespace:function(){var e,t,a,o=arguments,n=null;for(e=0;e<o.length;e+=1)for(a=o[e].split("."),n=uvol,t="uvol"==a[0]?1:0;t<a.length;t+=1)n[a[t]]=n[a[t]]||{},n=n[a[t]];return n},getCachedScript:function(e,t){return t=$.extend(t||{},{dataType:"script",cache:!0,url:e}),jQuery.ajax(t)},loadModules:function(e){var t=[];e.forEach(function(e){var a="string"==typeof e?e:e.moduleName;t.push(uvol.global.moduleMap[a]),uvol.global.loadedModules.push(a)});var a=$.map(t,function(e){return uvol.global.getCachedScript(e)});return a.push($.Deferred(function(e){$(e.resolve)})),$.when.apply($,a)},setMap:function(e){uvol.global.moduleMap=e},load:function(e,t){e=[].concat(e),uvol.global.loadModules(e).done(function(){e.forEach(function(e){var t="string"==typeof e?e:e.moduleName;uvol.global.loadedModules.indexOf(t)!==-1&&uvol.global.initialisedModules.indexOf(t)===-1?("undefined"!=typeof e.init?uvol[t].init(e.init):uvol[t].init(),uvol.global.initialisedModules.push(t),console.log(t+" module loaded")):console.log(t+" module already loaded")}),"undefined"!=typeof t&&t()}).fail(function(e){console.error(e)})},datePickerOld:function(e){var t={showOn:"focus",dateFormat:"dd/mm/yyyy",showOtherMonths:!0,selectOtherMonths:!0,changeMonth:!0,changeYear:!0,showButtonPanel:!0,yearRange:"-100:+50"};"undefined"!=typeof e.minDate&&(t.minDate=e.minDate),"undefined"!=typeof e.maxDate&&(t.maxDate=e.maxDate),"undefined"!=typeof e.restrict&&(t.onSelect=function(t,a){$("#"+e.restrict).datepicker("option","maxDate",t)}),"undefined"!=typeof e.restrictMin&&(t.onSelect=function(t,a){if("undefined"!=typeof e.restrictMaxDays){var o=new Date(a.selectedYear+"/"+(a.selectedMonth+1)+"/"+a.selectedDay);o.setDate(o.getDate()+parseInt(e.restrictMaxDays)),"undefined"!=typeof e.maxDate&&"-1"==e.maxDate&&(today=new Date,today.setHours(0),today.setMinutes(0),today.setSeconds(0),today.setDate(today.getDate()-1),o>=today&&(o=today),console.log(o)),$("#"+e.restrictMin).datepicker("option","maxDate",o)}$("#"+e.restrictMin).datepicker("option","minDate",t)}),$(e.target).hasClass("form-control")?$(e.target).after('<span class="glyphicon glyphicon-calendar form-control-feedback internal-calendar" aria-hidden="true"></span>').parent().addClass("has-feedback"):(t.showOn="both",t.buttonImage="/images/calendar_new.gif",t.buttonImageOnly=!0),$(e.target).datepicker(t),$("button.ui-datepicker-current").on("click",function(){$.datepicker._curInst.input.datepicker("setDate",new Date).datepicker("hide").blur()})},dragabbleTable:function(e,t){$("#"+e+" tbody").sortable({placeholder:"ui-state-highlight",axis:"y",containment:"parent",tolerance:"pointer",cursor:"move",delay:150,distance:10,handle:".handle",update:function(a,o){var n=new Array;$("#"+e+" tbody tr").each(function(e){n.push($(this).data("itemid"))}),console.log(n),$.ajax({data:{items:n},type:"POST",url:t})}}),$("#"+e).disableSelection()},init:function(){uvol.global.htmlExtensions(),"undefined"!=typeof Pace&&(Pace.options={ajax:{ignoreURLs:["hotjar","mixpanel"],trackWebSockets:!1}}),$(".nav-sidebar .sidebar-top-level-items li").hoverIntent({over:function(e){if($("#layout").hasClass("sidebar-expanded"))var t=".sidebar-sub-level-items:not(.is-fly-out-only)";else var t=".sidebar-sub-level-items";$(this).find(t).first().css("top",$(this).position().top+60+"px").show()},out:function(e){$(this).find(".sidebar-sub-level-items").hide()},timeout:300}),$("#collapse-link").click(function(e){e.preventDefault();var t=$("#layout");t.hasClass("sidebar-expanded")?(Cookies.set("sidebar","collapsed"),t.addClass("sidebar-collapsed").removeClass("sidebar-expanded")):(Cookies.set("sidebar","expanded"),t.removeClass("sidebar-collapsed").addClass("sidebar-expanded"))});var e=$(".nav-sidebar-inner-scroll");e.length>0&&e.slimScroll({height:"100%"}),function(e){e.QueryString=function(e){if(""==e)return{};for(var t={},a=0;a<e.length;++a){var o=e[a].split("=",2);2==o.length&&(t[o[0]]=decodeURIComponent(o[1].replace(/\+/g," ")))}return t}(window.location.search.substr(1).split("&"))}(jQuery)},loadSpinner:function(){return'<span class="fa fa-circle-o-notch fa-spin fa-fw"></span>'},trackEvent:function(e,t,a){ga("send",{hitType:"event",eventCategory:e,eventAction:t,eventLabel:a})},ajaxPopover:function(e,t,a){return $.ajax({url:"/ajax/load-popover.asp",data:{m:e,i:t},success:function(e){$("#"+a).html(e)}}),'<div id="'+a+'">Loading...</div>'},stripEmoji:function(e){var t=/(?:\ud83d[\ude00-\ude4f])*((?:(?!\ud83d[\ude00-\ude4f])[\S\s])+)(?:\ud83d[\ude00-\ude4f])*/g;return e.replace(t,"$1").replace(/âœ³/g,"")},ucfirst:function(e,t){return e=t?e.toLowerCase():e,e.replace(/(\b)([a-zA-Z])/,function(e){return e.toUpperCase()})},datePicker:function(e){config={},config.format="dd/mm/yyyy",config.todayHighlight=!0,e.data("default-year")&&(config.defaultViewDate={year:e.data("default-year"),month:e.data("default-month"),day:e.data("default-day")}),e.data("orientation")&&(config.orientation=e.data("orientation")),config.autoclose=!0,e.attr("placeholder","Enter date as dd/mm/YYYY or click to select"),e.datepicker(config)},smoothScrollToElement:function(e,t){"undefined"==t&&(t=2e3);var a=$(e);a.is(":visible")||a.parent().removeClass("collapse");var o=a.offset().top/$(window).scrollTop();return!!(o<.515||o>1.2||isNaN(o))&&($("html, body").animate({scrollTop:a.offset().top},t),!0)},addValidationErrors:function(e,t){t="undefined"==typeof t?null:t;for(var a in e)if(e.hasOwnProperty(a)){var o=a;o.indexOf(".")!=-1&&(o=o.replace(".","["),o=o.replace(".","]["),o+="]");var n=$((null==t?"":t+" ")+'[name="'+o+'"]'),i=n.parent(".form-group");0==i.length&&(i=n.closest(".form-group")),i.addClass("has-error"),i.append('<p class="help-block" data-ajax="true">'+e[a][0]+"</p>")}},clearValidationErrors:function(){$(".has-error").each(function(){var e=this,t=$(this).find(".help-block");t.each(function(){$(this).data("ajax")&&($(this).remove(),$(e).removeClass("has-error"))})})},getUrlParameter:function(e){var t,a,o=decodeURIComponent(window.location.search.substring(1)),n=o.split("&");for(a=0;a<n.length;a++)if(t=n[a].split("="),t[0]===e)return void 0===t[1]||t[1]},initialiseCharacterCount:function(){$("[data-show-character-count]").each(function(){if(1==Boolean($(this).data("show-character-count"))){var e=$(this).data("max-length");0===$(this).parent().find("#text-count").length&&("undefined"==typeof e?$(this).after('<span id="text-count" class="pull-right">'+$(this).val().length+" characters</span>"):$(this).after('<span id="text-count" class="pull-right">'+$(this).val().length+"/"+e+" characters</span>"))}}),$("[data-show-character-count]").keyup(function(){var e=$(this).parent().find("#text-count"),t=$(this).data("max-length");"undefined"==typeof t?$(e).text($(this).val().length+" characters"):$(e).text($(this).val().length+"/"+t+" characters")}),$("[data-max-length]").keyup(function(){var e=$(this).data("max-length");$(this).val().length>=e&&$(this).val($(this).val().substr(0,e))})},shuffle:function(e){var t,a,o;for(o=e.length;o;o--)t=Math.floor(Math.random()*o),a=e[o-1],e[o-1]=e[t],e[t]=a},htmlExtensions:function(){$('[data-toggle="datepicker"]').each(function(e){uvol.global.datePicker($(this))}),$('[data-toggle="editor"]').each(function(e){uvol.global.simplemde[$(this).attr("id")]=new SimpleMDE({hideIcons:["code","image","fullscreen","side-by-side"],element:$(this)[0],autosave:{enabled:!0,uniqueId:$(this).attr("id")}})}),$('[data-toggle="check-all"]').on("click",function(e){e.preventDefault(),$($(this).data("selector")).each(function(){$(this).prop("disabled")||$(this).prop("checked",!0)})}),$('[data-toggle="uncheck-all"]').on("click",function(e){e.preventDefault(),$($(this).data("selector")).each(function(){$(this).prop("checked",!1)})}),$('[data-toggle="checked"]').on("click",function(e){state=$(this).prop("checked"),$($(this).data("selector")).each(function(){$(this).prop("disabled")||$(this).prop("checked",state)})}),$('[data-toggle="tooltip"]').tooltip({trigger:"hover"}),$('[data-toggle="dialler"]').on("click",function(e){window.location="tel:"+$(this).data("number")}),$('[data-toggle="clockpicker"]').clockpicker({donetext:"Done",autoclose:!0}),$("*[data-popover]").popover({html:!0,trigger:"hover",container:"body",placement:"top",content:function(){return $.ajax({url:"/ajax/load-popover.asp",data:{m:$(this).data("popover"),i:$(this).data("id")},dataType:"html",async:!1}).responseText}}),$("body").on("show.bs.popover",function(){var e=$(".popover");e&&e.remove()}),$(".strip-emoji").on("blur",function(e){$(this).val(uvol.global.stripEmoji($(this).val()))}),uvol.global.initialiseCharacterCount(),$("[data-smooth-scroll-to]").click(function(e){e.preventDefault(),uvol.global.smoothScrollToElement($(this).data("smooth-scroll-to"),$(this).data("smooth-scroll-speed"))}),$("[data-same-height]").each(function(){var e=$($(this).data("same-height"));0!=e.length&&($(this).css("min-height",e.outerHeight()),$(this).data("same-height-max")&&$(this).css("max-height",e.outerHeight()))}),$("[data-prevent-modal]").click(function(e){e.stopPropagation()});var e=[];$("[data-same-height-group]").each(function(){var t=$(this).data("same-height-group");if(e.indexOf(t)==-1){var a=$("[data-same-height-group='"+t+"']"),o=0;a.each(function(){$(this).outerHeight()>o&&(o=$(this).outerHeight())}),a.each(function(){"undefined"!=typeof $(this).data("same-min-height-group")?$(this).css("min-height",o):$(this).height(o)}),e.push(t)}});var t=new Date;t.setDate(t.getDate()+1),$(".reminder-button").datepicker({startDate:t}).on("changeDate",function(e){var t=$(this),a=t.data("type");"button"===a?t.removeClass("btn-primary-transparent").addClass("btn-danger-transparent"):t.removeClass("btn-primary").addClass("btn-danger"),form=t.parent(),0==form.find("#reminder_set").length?form.append('<input type="hidden" id="reminder_set" name="reminder_set" value="true" />'):form.find("#reminder_set").val(!0);var o=new Date(e.date),n=o.getFullYear()+"-"+(o.getMonth()+1)+"-"+o.getDate();0==form.find("#reminder_date").length?form.append('<input type="hidden" id="reminder_date" name="reminder_date" value="'+n+'" />'):form.find("#reminder_date").val(n),t.data("id")&&(t.data("date",n),uvol.api.call({route:"reminder/update",type:"POST",data:{id:t.data("id"),type:t.data("type"),title:t.data("title"),date:n},complete:function(){console.log("done!")}})),t.datepicker("hide")}).on("show",function(e){var t=$(this),a=t.data("type");(t.hasClass("btn-danger")||t.hasClass("btn-danger-transparent"))&&0==$(".datepicker tfoot").find(".clear-reminder").length&&($(".datepicker tfoot").append('<tr class="clear-reminder"><th colspan="7">Clear Reminder</th></tr>'),$(".datepicker").on("click",".clear-reminder",function(){var e=t;"button"===a?e.removeClass("btn-danger-transparent").addClass("btn-primary-transparent"):e.removeClass("btn-danger").addClass("btn-primary"),form=t.parent(),form.find("#reminder_set").remove(),form.find("#reminder_date").remove(),t.data("id")&&uvol.api.call({route:"reminder/update",type:"POST",data:{id:t.data("id"),type:t.data("type")},complete:function(){console.log("done!")}}),e.datepicker("hide"),e.datepicker("update","")}))}).on("hide",function(e){$(".datepicker tfoot").closest(".clear-reminder").remove()}),$(".reminder-button").length>0&&uvol.global.load(["api"]),$(".reminder-button").click(function(){var e=$(this);if(e.data("date")){var t=e.data("date").split("-");e.datepicker("update",new Date(t[0],t[1]-1,t[2]))}e.datepicker("show")}),$(document).on("click","button[data-radio-name]",function(){$('button[data-radio-name="'+$(this).data("radioName")+'"]').removeClass("active"),$(this).addClass("active"),$('input[name="'+$(this).data("radioName")+'"]').val($(this).text())}),$("[data-character-limit]").each(function(){var e=parseInt($(this).data("character-limit")),t=$(this).text();t.length>e&&($(this).text(t.substring(0,e)),$(this).html($(this).html()+"[<a>...</a>]"))}),$("[data-tabs]").each(function(){var e=document.location.hash,t=$(this);e&&(e=e.replace("/",""),$(this).find("li").each(function(){if($(this).find("a").attr("href")==e)return t.find('a[href="'+e+'"]').tab("show"),!1}))}),$(".table-hover-actions tbody tr").hover(function(){$(this).find(".actions-bar").css("opacity",1)},function(){$(this).find(".actions-bar").css("opacity",0)}),$(window).on("resize",function(){uvol.global.resizeHoverRows()}).trigger("resize")},resizeHoverRows:function(){$(".table-hover-actions tbody tr").each(function(){var e=$(this),t=e.find(".actions-bar"),a=e.position();t.css({top:a.top,left:a.left,width:e.width(),height:e.height(),"line-height":e.height()+"px"})})},validateEmail:function(e){var t=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(e)}},$(document).ready(uvol.global.init),"undefined"==typeof uvol||!uvol)var uvol={};uvol.oppSearch={},uvol.oppSearch={gecodeAjax:null,init:function(){},placeAutocomplete:function(e,t){var a=$("#"+e);$("#"+t);a.autocomplete({source:function(e,t){$.ajax({url:"/api/geocode",headers:{Accept:"application/x.uvol.v2+json"},data:{q:e.term},success:function(e){t(e)}})},focus:function(e,t){return a.val(t.item.name),!1},select:function(e,a){switch(a.item.type){case"geocode":$("#lat").val(a.item.lat),$("#lon").val(a.item.lon),$("#geojson_id").val(""),$("#distance").prop("disabled",!1);break;case"geojson":$("#lat").val(""),$("#lon").val(""),$("#geojson_id").val(a.item.type_id),$("#distance").prop("disabled",!0)}return $("#search").val("false"),$("#"+t).prop("disabled",!1),$("#"+t).click(),!1}}).autocomplete("instance")._renderItem=function(e,t){switch(t.type){case"geocode":return $("<li>").append("<a><span class='fa fa-map-marker'></span> "+t.name+"</a>").appendTo(e);case"geojson":return $("<li>").append("<a><span class='fa fa-circle-thin'></span> "+t.name+" <span class='small'>("+t.classification+")</span></a>").appendTo(e)}}}},$(document).ready(uvol.oppSearch.init);var uVolMap=uVolMap||{};uVolMap.core={loadingGoogleMaps:!1,loadGoogleMap:function(e){var t=jQuery.Deferred();return uVolMap.core.loadingGoogleMaps?t.reject("Google maps is already loading..."):(uVolMap.core.loadingGoogleMaps=!0,"object"!=typeof google||"object"!=typeof google.maps?$.getScript("//maps.googleapis.com/maps/api/js?key="+e+"&libraries=geometry",function(){t.resolve(!0)}):t.resolve(!0),t.promise())},createMap:function(e,t,a,o,n){"undefined"==typeof t&&(t=new google.maps.LatLng(54.30370443989809,(-4.780082702636719))),"undefined"==typeof a&&(a=5),"undefined"==typeof e&&(e="map");var i={center:t,streetViewControl:!1,mapTypeControl:!1,zoom:a};return"undefined"!=typeof o&&(i.minZoom=o),"undefined"!=typeof n&&(i.maxZoom=n),new google.maps.Map(document.getElementById(e),i)},createMarker:function(e,t){if("undefined"==typeof t)return new google.maps.Marker(e);var a=new google.maps.Marker(e);return map.setZoom(t),map.panTo(a.position),a},getGoogleResults:function(e){return $.get("//maps.googleapis.com/maps/api/geocode/json?address="+e+"&components=country:GB|IE")},getLatLngFromSearch:function(e){var t=jQuery.Deferred();return uVolMap.core.getGoogleResults(e).done(function(e){var a={status:e.status};"OK"==a.status?(a.latLng=new google.maps.LatLng(e.results[0].geometry.location.lat,e.results[0].geometry.location.lng),t.resolve(a)):t.reject(null)}),t.promise()},createSearchAutoComplete:function(e,t,a,o,n,i){a="undefined"!=typeof a&&a,o="undefined"!=typeof o&&o,n="undefined"!=typeof n&&n,i="undefined"!=typeof i&&i,$(e).autocomplete({source:function(r,s){"undefined"!=typeof t&&t.show(),$.ajax({url:"/api/geocode?q="+$(e).val()+(a?"&e=true":"")+(o?"&o=true":"")+(n?"&pca=true":"")+(i?"&regions=false":""),headers:{Accept:"application/x.uvol.v2+json"},type:"GET",success:function(e){var a=[];if("undefined"!=typeof e)for(var o=0;o<e.length;o++)a.push({id:e[o].type_id,label:e[o].name,type:e[o].type,lat:e[o].lat,lon:e[o].lon,polygon:"undefined"!=typeof e[o].polygon?e[o].polygon:null,address:"undefined"!=typeof e[o].address?e[o].address:null,pca_id:"undefined"!=typeof e[o].pca_id?e[o].pca_id:void 0});"undefined"!=typeof t&&t.hide(),s(a)}})},minLength:3,open:function(){},close:function(){},focus:function(e,t){},select:function(e,t){return $(this).trigger("change"),!1}}).data("ui-autocomplete")._renderItem=function(e,t){var a="";switch(t.type){case"geolocation":a='<span class="fa fa-location-arrow" aria-hidden="true"></span> ';break;case"geojson":a='<span class="fa fa-circle-thin" aria-hidden="true"></span> ';break;case"geocode":a='<span class="fa fa-map-marker" aria-hidden="true"></span> '}return $("<li></li>").data("item.autocomplete",t).append("<a>"+a+t.label+"</a>").appendTo(e)}},createMapFeatureFromSearch:function(e,t){"undefined"!=typeof map&&(map=t);var a=jQuery.Deferred();return $.get("/api/geojson/getSearchTermGeometry/"+e,function(e){if(e='{"type":"FeatureCollection","features":['+e+"]}",e=JSON.parse(e),feature=map.data.addGeoJson(e),map.data.setStyle({fillColor:"#C2EEFC",strokeWeight:.5,visible:!0}),e.features.length>0){var t=uVolMap.core.geoJsonToCoords(e.features[0].geometry.coordinates);cPolygon=new google.maps.Polygon({paths:t}),map.fitBounds(cPolygon.getBounds())}a.resolve(feature)}),a.promise()},geoJsonToCoords:function(e){for(var t=[],a=-1,o=0,n=0;n<e.length;n++)for(var i=0;i<e[n].length;i++)e[n][i].length>o&&(a=n,o=e[n][i].length);var r=e[a];for(1==r.length&&(r=e[a][0]),n=0;n<r.length;n++)t.push({lat:r[n][1],lng:r[n][0]});return t},radiusToZoom:function(e){return Math.round(14-Math.log(e)/Math.LN2)},getQueryVariable:function(e){for(var t=window.location.search.substring(1),a=t.split("&"),o=0;o<a.length;o++){var n=a[o].split("=");if(n[0]==e)return n[1]}return!1},getNearbyLocations:function(e,t,a,o,n){var i=a.getNorthEast(),r=a.getSouthWest(),s={neLat:i.lat(),neLng:i.lng(),swLat:r.lat(),swLng:r.lng()},l="map/get-nearby-locations/"+e+"/"+t+"/"+JSON.stringify(s)+"/"+JSON.stringify(o);config={route:l,version:"v1",type:"GET",success:function(e){n&&n(e)}},uvol.api.call(config)},getLocationDetails:function(e,t){var a="map/get-location-details/"+e;config={route:a,version:"v1",type:"GET",success:function(e){t&&t(e)}},uvol.api.call(config)}};var uVolChat=uVolChat||{};uVolChat.core={showMissedBadge:!1,token:null,openChatWidget:function(e){var t=$('[data-chat-head-id="'+e+'"]');t.find(".chat-messages").show(),t.data("open",!0),t.find(".chat-chevron i").removeClass("fa-chevron-up").addClass("fa-chevron-down"),t.find("input").focus(),$(".chat-scroll").each(function(){$(this).scrollTop($(this)[0].scrollHeight)})},closeChatWidget:function(e){var t=$('[data-chat-head-id="'+e+'"]');t.find(".chat-messages").hide(),t.removeData("open"),t.find(".chat-chevron i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),uVolChat.core.toggleChatAlert(e,"hide")},isChatOpen:function(e){var t=$('[data-chat-head-id="'+e+'"]').find(".chat-messages");return t.is(":visible")},toggleChat:function(e){return $('[data-chat-head-id="'+e+'"] .chat-head').click()},setChatAlert:function(e,t){var a=$('[data-chat-head-id="'+e+'"]').find(".chat-head .alert-popover");a.attr("data-original-title",t),a.tooltip("show")},toggleChatAlert:function(e,t){var a=$('[data-chat-head-id="'+e+'"]').find(".chat-head .alert-popover");a.tooltip("undefined"==typeof t?"show":t)},scrollToBottom:function(e){setTimeout(function(){var t=$('[data-chat-head-id="'+e+'"]').find(".chat-messages .chat-scroll");t.scrollTop(t[0].scrollHeight)},100)},chatLoading:function(e,t){var a="undefined"!=typeof t,o=$('[data-chat-head-id="'+e+'"]').find(".chat-loading-spinner");o.length>0&&(a?($('[data-chat-id="'+e+'"]').attr("placeholder","Enter your message here"),o.hide()):o.show()),uVolChat.core.showMissedBadge||(uVolChat.core.showMissedBadge=!0)},refreshChat:function(e,t,a,o){a=1==a;var o="undefined"!=typeof o&&o;"undefined"!=typeof e&&$.ajax({url:"/api/chat/messages",type:"post",headers:{Authorization:"Bearer "+uVolChat.core.token},data:{chat_id:e,isOpen:o},statusCode:{401:function(){"undefined"!=typeof chatRefresher&&clearInterval(chatRefresher);var t=$('[data-chat-head-id="'+e+'"]');t.find(".chat-scroll").html("Timeout: please refresh the page.")}}}).done(function(o){var n=o.data,i=$('[data-chat-id="'+e+'"]').parent().parent().find(".chat-scroll");n.length>0&&i.find("ul").empty();for(var r in n){var s=n[r],l=t==s.author_id,d='<li class="'+(l?"pull-right":"pull-left")+'">'+(l?"":'<img alt="image" class="img-circle" src="'+s.author_avatar+'">')+'<div class="message"><div class="message-author">'+s.author+" said:</div>"+s.message+"</div>"+(l?'<img alt="image" class="img-circle" src="'+s.author_avatar+'">':"")+'<div class="createdAt '+(l?"createdAtRight":"createdAtLeft")+'"><abbr title="'+s.created_at+'">'+s.created_at_diff+"</abbr></div></li>";i.find("ul").append(d)}var c=$('[data-chat-head-id="'+e+'"]');if(c.data("chat-message-count")<i.find("ul li").size()&&uVolChat.core.showMissedBadge){uVolChat.core.scrollToBottom(e);var u=(i.find("ul li").size()-c.data("chat-message-count"),$('[data-chat-head-id="'+e+'"]').find(".chat-head .title"));0==u.find("#missed-count").length&&(uVolChat.core.isChatOpen(e)||(uVolChat.core.setChatAlert(e,"You have a new message!"),uVolChat.core.toggleChat(e)))}a&&uVolChat.core.scrollToBottom(e),c.data("chat-message-count",i.find("ul li").size()),uVolChat.core.chatLoading(e,!0)})},handleMessageReply:function(e,t,a){var o=$("#chat-input-"+a.data("chat-id"));if(o&&o.val().length>0){var n=o.val(),i=o.data("chat-id");$(o).val(""),uVolChat.core.chatLoading(o.data("chat-id")),$('[data-chat-id="'+o.data("chat-id")+'"]').attr("placeholder","Sending..."),$.ajax({url:"/api/chat/reply",type:"post",headers:{Authorization:"Bearer "+uVolChat.core.token},data:{message:n,chat_id:o.data("chat-id")}}).done(function(){uVolChat.core.showMissedBadge=!1,uVolChat.core.refreshChat(i,t,!0),uVolChat.core.toggleChatAlert(i,"hide")}).fail(function(e){alert("Your message failed to sent, please try again!")}).always(function(){var e=$('[data-chat-head-id="'+i+'"]').find(".chat-head .title");0!=e.find("#missed-count").length&&e.find("#missed-count").remove()})}},onMultipleChatsLoad:function(){var e=0,t=null;$(".chat").each(function(){t=$(this).css("width")+(null==t?0:t),e>=1&&$(this).css("right","calc("+t+" + 20px)"),e++})},getUrlParameter:function(e){var t,a,o=decodeURIComponent(window.location.search.substring(1)),n=o.split("&");for(a=0;a<n.length;a++)if(t=n[a].split("="),t[0]===e)return void 0===t[1]||t[1]}};